{% extends "base.html" %}

{% block content %}

<h2>Bags in the {{ space }} space</h2>

<form>
  <p>
    <label for="external_identifier">identifier starts with:</label>
    <input placeholder="b123" name="external_identifier" id="external_identifier_input" oninput="queryContext.changeExternalIdentifierPrefix(this.value)" {% if query_context.external_identifier_prefix %}value="{{ query_context.external_identifier_prefix }}"{% endif %}>
  </p>

  <p>
    <label for="date_created_after">bags created between:</label>
    <input type="date" placeholder="2019-11-30" name="date_created_after" id="date_created_after" onchange="queryContext.changeDateCreatedAfter(this.value)" {% if query_context.created_after %}value="{{ query_context.created_after }}"{% endif %}>
    and
    <input type="date" placeholder="2020-01-30" name="date_created_before" id="date_created_before" onchange="queryContext.changeDateCreatedBefore(this.value)" {% if query_context.created_before %}value="{{ query_context.created_before }}"{% endif %}>
  </p>
</form>

<details>
  <summary>get bag statistics</summary>

  <ul>
    <li id="li__total_bags">NNN bags</li>
    <li id="li__total_file_count">NN files</li>
    <li id="li__total_file_size">NN GB</li>
  </ul>

  <p>File types:</p>

  <table id="total_file_stats_table">
    <tbody id="total_file_stats">
    </tbody>
  </table>
</details>

<table class="pagination">
  <tr>
    {% if page > 1 %}
    <td class="prev_page">
      <a href="#" onclick="previousPage({{ page }});">&larr; previous page</a>
    </td>
    {% endif %}

    {% if page < total_pages %}
    <td class="next_page">
      <a href="#"onclick="nextPage({{ page }})">next page &rarr;</a>
    </td>
    {% endif %}
  </tr>
</table>

<table id="bags_table">
  <thead>
    <th>identifier</th>
    <th>file count</th>
    <th>size</th>
    <th>date created</th>
    <th>version</th>
    <th>download</th>
  </thead>
  <tbody id="tbody__bags">
  </tbody>
</table>

<table class="pagination">
  <tr>
    {% if page > 1 %}
    <td class="prev_page">
      <a href="#" onclick="previousPage({{ page }});">&larr; previous page</a>
    </td>
    {% endif %}

    {% if page < total_pages %}
    <td class="next_page">
      <a href="#"onclick="nextPage({{ page }})">next page &rarr;</a>
    </td>
    {% endif %}
  </tr>
</table>

<script>
  var bagHandler = new BagHandler();

  var queryContext = new QueryContext(
    {{ query_context.space | to_json | safe }},
    {{ query_context.external_identifier_prefix | to_json | safe }},
    {{ query_context.created_before | to_json | safe }},
    {{ query_context.created_after | to_json | safe }},
    {{ query_context.page | to_json | safe }},
    {{ query_context.page_size | to_json | safe }},
    bagHandler
  );

  queryContext.updateResults();
</script>

{% endblock %}
